<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Cove - Minecraft Realm</title>
    <meta name="google-signin-client_id" content="1009438615864-alk4qlhruufpl1dr4qco45l2kjajat5d.apps.googleusercontent.com" />
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0b0f10 0%, #0d1618 50%, #0f1a1d 100%);
            color: #b2f0e9;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Animated background bubbles */
        .bubble {
            position: fixed;
            background: rgba(14, 246, 204, 0.1);
            border-radius: 50%;
            animation: float 6s ease-in-out infinite;
        }

        .bubble:nth-child(1) {
            width: 40px;
            height: 40px;
            left: 10%;
            animation-delay: 0s;
        }

        .bubble:nth-child(2) {
            width: 20px;
            height: 20px;
            left: 20%;
            animation-delay: 2s;
        }

        .bubble:nth-child(3) {
            width: 60px;
            height: 60px;
            left: 80%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
        }

        header {
            background: linear-gradient(135deg, #0d1c1f, #1a2e32);
            padding: 3rem 2rem;
            text-align: center;
            border-bottom: 3px solid #0ef6cc;
            box-shadow: 0 4px 20px rgba(14, 246, 204, 0.3);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .eye-logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #0ef6cc, #85f1dc);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #0b0f10;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(14, 246, 204, 0.5);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        header h1 {
            font-size: 3.5rem;
            color: #85f1dc;
            text-shadow: 0 0 20px rgba(133, 241, 220, 0.5);
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1.2rem;
            color: #0ef6cc;
            font-style: italic;
            opacity: 0.9;
        }

        .profile-pic {
            height: 60px;
            width: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-left: 20px;
            border: 3px solid #0ef6cc;
            box-shadow: 0 0 15px rgba(14, 246, 204, 0.5);
        }

        nav {
            background: rgba(11, 26, 30, 0.9);
            padding: 1rem;
            display: flex;
            justify-content: center;
            gap: 2rem;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav a {
            color: #85f1dc;
            text-decoration: none;
            font-weight: bold;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        nav a:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(14, 246, 204, 0.2), transparent);
            transition: left 0.5s;
        }

        nav a:hover:before {
            left: 100%;
        }

        nav a:hover {
            color: #0ef6cc;
            background: rgba(14, 246, 204, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(14, 246, 204, 0.3);
        }

        /* Login navigation section */
        .login-navigation {
            background: rgba(13, 22, 25, 0.95);
            width: 100%;
            border-bottom: 2px solid #0ef6cc;
            box-shadow: 0 2px 10px rgba(14, 246, 204, 0.3);
        }

        .login-nav {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 8px 10px;
            gap: 1rem;
            align-items: center;
        }

        .login-nav a,
        #google-signin-button,
        #logout {
            color: #85f1dc;
            text-decoration: none;
            font-weight: 600;
            padding: 12px 18px;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-block;
            position: relative;
            border: none;
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
        }

        .login-nav a:hover,
        #google-signin-button:hover,
        #logout:hover {
            background: linear-gradient(135deg, #0ef6cc 0%, #85f1dc 100%);
            color: #0b0f10;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(14, 246, 204, 0.4);
        }

        main {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .hero {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, rgba(14, 246, 204, 0.1), rgba(133, 241, 220, 0.05));
            border-radius: 20px;
            margin-bottom: 3rem;
            border: 1px solid rgba(14, 246, 204, 0.2);
        }

        .hero h2 {
            font-size: 2.5rem;
            color: #0ef6cc;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.3rem;
            color: #b2f0e9;
            max-width: 600px;
            margin: 0 auto;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #0d1618, #1a2328);
            padding: 2rem;
            border-radius: 15px;
            border-left: 5px solid #0ef6cc;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(14, 246, 204, 0.2);
        }

        .feature-card h3 {
            color: #0ef6cc;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feature-card p {
            color: #b2f0e9;
            line-height: 1.7;
        }

        .stats-section {
            background: linear-gradient(135deg, rgba(13, 28, 31, 0.8), rgba(26, 46, 50, 0.8));
            padding: 3rem 2rem;
            border-radius: 20px;
            margin: 3rem 0;
            text-align: center;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .stat-item {
            padding: 1.5rem;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: bold;
            color: #0ef6cc;
            display: block;
        }

        .stat-label {
            color: #85f1dc;
            font-size: 1.1rem;
            margin-top: 0.5rem;
        }

        .discord-section {
            background: linear-gradient(135deg, #5865f2, #4752c4);
            padding: 3rem 2rem;
            border-radius: 20px;
            text-align: center;
            margin: 3rem 0;
        }

        .discord-button {
            display: inline-block;
            background: #ffffff;
            color: #5865f2;
            padding: 1rem 2rem;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1rem;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }

        .discord-button:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .rules-section {
            background: rgba(133, 241, 220, 0.05);
            padding: 2rem;
            border-radius: 15px;
            border: 1px solid rgba(14, 246, 204, 0.2);
            margin: 3rem 0;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rules-list li {
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(14, 246, 204, 0.1);
            position: relative;
            padding-left: 2rem;
        }

        .rules-list li:before {
            content: '⚡';
            position: absolute;
            left: 0;
            color: #0ef6cc;
            font-size: 1.2rem;
        }

        footer {
            background: linear-gradient(135deg, #0d1c1f, #1a2e32);
            padding: 3rem 2rem 2rem;
            text-align: center;
            border-top: 3px solid #0ef6cc;
            margin-top: 4rem;
        }

        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .footer-links a {
            color: #85f1dc;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .footer-links a:hover {
            background: rgba(14, 246, 204, 0.1);
            color: #0ef6cc;
        }

        @media (max-width: 768px) {
            nav {
                flex-wrap: wrap;
                gap: 1rem;
            }
            
            header {
                flex-direction: column;
                align-items: center;
                padding: 20px 15px;
            }
            
            header h1 {
                font-size: 2.5rem;
            }
            
            .hero h2 {
                font-size: 2rem;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            main {
                padding: 1rem;
            }

            .login-nav {
                flex-direction: column;
                width: 100%;
            }

            .login-nav a,
            #google-signin-button,
            #logout {
                width: 100%;
                padding: 15px;
                border-bottom: 1px solid #0ef6cc;
                text-align: left;
                margin: 2px 0;
            }

            .profile-pic {
                margin: 20px auto;
                display: block;
            }
        }
    </style>
</head>
<body>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <header>
        <div class="logo-container">
           <div class="eye-logo">
                <img src="https://raw.githubusercontent.com/1000000overit/TheCoveSite/refs/heads/main/pfp.png" 
                     alt="https://raw.githubusercontent.com/1000000overit/TheCoveSite/refs/heads/main/pfp.png" 
                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;"
                     onerror="this.style.display='none'; this.parentElement.innerHTML='🏝️'; this.parentElement.style.fontSize='3rem'; this.parentElement.style.display='flex'; this.parentElement.style.alignItems='center'; this.parentElement.style.justifyContent='center';">
           </div>
        </div>
        <div>
            <h1>The Cove</h1>
            <p class="tagline">Where Adventure Meets Community</p>
        </div>
        <img id="profile-pic" class="profile-pic" src="" alt="Profile Picture" style="display:none;" />
    </header>

    <div class="login-navigation">
        <div class="login-nav">
            <a id="discord-login" href="#">Login with Discord</a>
            <span id="google-signin-button"></span>
            <a id="logout" href="#" style="display:none;">Logout</a>
        </div>
    </div>

    <nav>
        <a href="#about">About</a>
        <a href="Rules.html">Rules</a>
        <a href="Products.html">Donations</a>
        <a href="Feature.html">Features</a>
    </nav>

    <main>
        <section class="hero">
            <h2>Welcome to Paradise</h2>
            <p>Dive into The Cove, where creativity flows like ocean waves and friendships are built block by block. Our thriving Minecraft realm offers endless possibilities for exploration, building, and community.</p>
        </section>

        <div class="features-grid">
            <div class="feature-card" id="about">
                <h3>🌊 About The Cove</h3>
                <p>The Cove is more than just a Minecraft realm—it's a sanctuary for builders, explorers, and dreamers. Our community has been crafting memories together since 2024, creating a world where creativity knows no bounds and every player has a story to tell.</p>
            </div>

            <div class="feature-card">
                <h3>🏗️ Build Together</h3>
                <p>Join our massive community projects! From sprawling cities to intricate redstone contraptions, we believe the best builds happen when minds come together. Share resources, exchange ideas, and watch your wildest architectural dreams come to life.</p>
            </div>

            <div class="feature-card">
                <h3>🗺️ Explore Endlessly</h3>
                <p>Our world is vast and full of secrets. Use your compass to discover hidden temples, mysterious caves, and player-made wonders. Every corner of The Cove holds a new adventure waiting to be discovered.</p>
            </div>

            <div class="feature-card">
                <h3>🎮 Events & Challenges</h3>
                <p>Weekly events keep things exciting! From Pvp, to Just Chill, we have it all</p>
            </div>

            <div class="feature-card">
                <h3>🛡️ Safe & Friendly</h3>
                <p>Our experienced moderators ensure a positive environment for all players. Zero tolerance for griefing, harassment, or toxicity. The Cove is a place where everyone can feel welcome and express their creativity freely.</p>
            </div>
        </div>

        <section class="stats-section" id="stats">
            <h2>The Cove by the Numbers</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number">100+</span>
                    <div class="stat-label">Active Players</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number">50+</span>
                    <div class="stat-label">Major Builds</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number">24/7</span>
                    <div class="stat-label">Uptime</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number">100%</span>
                    <div class="stat-label">Fun Guaranteed</div>
                </div>
            </div>
        </section>

        <section class="discord-section" id="join">
            <h2>🎮 Ready to Join The Adventure?</h2>
            <p>Connect with our amazing community on Discord! Get realm invites, participate in events, share your builds, and make new friends. Our Discord is the heart of The Cove community.</p>
            <a href="#" class="discord-button">Join Our Discord</a>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-links">
                <a href="Rules.html">Rules</a>
                <a href="Feature.html">Features</a>
                <a href="Products.html">Donations</a>
            </div>
            <p>&copy; 2025 The Cove Realm. Crafted with ❤️ by our amazing community.</p>
            <p style="margin-top: 1rem; opacity: 0.7; font-size: 0.9rem;">
                "In The Cove, every block tells a story, and every player writes their legend."
            </p>
        </div>
    </footer>

    <script>
        const sharedUser = {};
        const profilePic = document.getElementById("profile-pic");
        const discordLoginBtn = document.getElementById("discord-login");
        const googleButtonContainer = document.getElementById("google-signin-button");
        const logoutBtn = document.getElementById("logout");

        // Check if user is already logged in when page loads
        document.addEventListener('DOMContentLoaded', function() {
          checkLoginStatus();
        });

        function checkLoginStatus() {
          const userData = localStorage.getItem('socialHubUser');
          
          if (userData) {
            const user = JSON.parse(userData);
            Object.assign(sharedUser, user);
            showProfilePic(user.picture);
            showLogout();
          }
        }

        function showProfilePic(url) {
          profilePic.src = url;
          profilePic.style.display = "block";
        }

        function showLogout() {
          logoutBtn.style.display = "inline";
          discordLoginBtn.style.display = "none";
          googleButtonContainer.style.display = "none";
        }

        function resetUI() {
          profilePic.src = "";
          profilePic.style.display = "none";
          logoutBtn.style.display = "none";
          discordLoginBtn.style.display = "inline";
          googleButtonContainer.style.display = "inline";
          
          // Clear user data
          if (typeof(Storage) !== "undefined") {
            localStorage.removeItem('socialHubUser');
            localStorage.removeItem('discordToken');
          }
          
          // Reset shared user object
          Object.keys(sharedUser).forEach(key => delete sharedUser[key]);
          
          // For Google logout
          if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
            google.accounts.id.disableAutoSelect();
          }
        }

        logoutBtn.addEventListener("click", (e) => {
          e.preventDefault();
          resetUI();
        });

        // Google Login
        window.onload = () => {
          google.accounts.id.initialize({
            client_id: "1009438615864-alk4qlhruufpl1dr4qco45l2kjajat5d.apps.googleusercontent.com",
            client_secret: "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",
            callback: handleGoogleCredentialResponse
          });
          google.accounts.id.renderButton(
            googleButtonContainer,
            { theme: "outline", size: "medium" }
          );
          
          // Only prompt if user is not already logged in
          if (!localStorage.getItem('socialHubUser')) {
            google.accounts.id.prompt();
          }
        };

        function handleGoogleCredentialResponse(response) {
          const data = parseJwt(response.credential);
          
          // Store user data
          sharedUser.name = data.name;
          sharedUser.email = data.email;
          sharedUser.picture = data.picture;
          sharedUser.provider = 'google';
          
          // Save to localStorage
          localStorage.setItem('socialHubUser', JSON.stringify(sharedUser));
          
          showProfilePic(sharedUser.picture);
          showLogout();
        }

        function parseJwt(token) {
          return JSON.parse(atob(token.split('.')[1]));
        }

        // Discord Login - FIXED
        discordLoginBtn.addEventListener("click", (e) => {
          e.preventDefault();
          const clientId = "1378160469235204176";
          const redirectUri = encodeURIComponent("https://thecovesite.vercel.app/TheCove.html");
          const scope = encodeURIComponent("identify email");
          const discordUrl = `https://discord.com/api/oauth2/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}`;
          
          window.location.href = discordUrl;
        });

        // Discord Callback Handling (if redirected back)
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get("code");
        
        if (code) {
          // Create the form data to send
          const formData = new FormData();
          formData.append('client_id', '1378160469235204176');
          formData.append('client_secret', 'MQsr0a8ibMM6ZbwaDv5J_ky59-3FqhQS');
          formData.append('grant_type', 'authorization_code');
          formData.append('code', code);
          formData.append('redirect_uri', 'https://thecovesite.vercel.app/TheCove.html');
          
          fetch('https://discord.com/api/oauth2/token', {
            method: 'POST',
            body: formData
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            if (data.error) {
              throw new Error(`Discord OAuth error: ${data.error_description || data.error}`);
            }
            
            // Store the token for future use
            localStorage.setItem('discordToken', data.access_token);
              
            // Get user data with the access token
            return fetch('https://discord.com/api/users/@me', {
              headers: {
                Authorization: `Bearer ${data.access_token}`
              }
            });
          })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then(userData => {
            sharedUser.name = userData.username;
            sharedUser.email = userData.email || `${userData.username}@discord.local`;
            sharedUser.provider = 'discord';
            sharedUser.id = userData.id;
            
            // Set avatar URL if it exists
            if (userData.avatar) {
              sharedUser.picture = `https://cdn.discordapp.com/avatars/${userData.id}/${userData.avatar}.png?size=256`;
            } else {
              // Calculate default avatar number based on discriminator or user ID
              const defaultAvatarNumber = userData.discriminator ? 
                parseInt(userData.discriminator) % 5 : 
                parseInt(userData.id) % 5;
              sharedUser.picture = `https://cdn.discordapp.com/embed/avatars/${defaultAvatarNumber}.png`;
            }
            
            // Save to localStorage
            localStorage.setItem('socialHubUser', JSON.stringify(sharedUser));
            
            showProfilePic(sharedUser.picture);
            showLogout();
            
            // Remove the code from URL to prevent re-authentication on refresh
            window.history.replaceState({}, document.title, window.location.pathname);
          })
          .catch(err => {
            console.error("Discord login error:", err);
            alert("Discord login failed. Please try again.");
            
            // If token exchange fails, remove code from URL
            window.history.replaceState({}, document.title, window.location.pathname);
          });
        }
    </script>
</body>
</html>
